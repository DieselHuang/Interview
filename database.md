# 数据库面试题整理



1. 数据库范式

范式：一个数据库表的表结构所符合的某些标准。

* 第一范式：符合1NF的表属性不可分；
* 第二范式：消除非主属性对于码的部分函数依赖；
* 第三范式：消除非主属性对于码的传递函数依赖；

2. 数据库索引

索引是对数据库表中一个或多个列进行排序的数据结构。而数据库的实现使用的是B tree以及它的变形B+ tree。之所以不用二叉树和AVL树，是因为随着树的变大，深度也会变得很大，影响了搜索性能。

在InnoDB存储引擎中，是用b+树来实现索引的。

2.1 为什么b+树比b树更适合当索引

* B+树的磁盘读写代价低。因为在B+树中，存储具体信息的是叶子结点，内部结点相对较小，这样每次读入内存的时候就可以读取更多的关键字，减少IO次数；
* 查询效率更稳定。由于每次查询都要从根节点走到叶子节点，高度一致，查询效率相当；
* B+树只需要遍历叶子节点就可以达到查询效果，而b树需要对整棵树木进行中序遍历；

2.2 什么情况下设置了索引不可用

* 用like做模糊匹配的时候；
* OR语句前后没有同时用索引；
* 多列索引，必须满足最左索引匹配原则；

2.3 索引的分类

聚簇索引和非聚簇索引的区别：

* 聚簇索引的叶节点就是数据节点，而非聚簇索引的叶节点还是索引，通过指针指向对应的数据块。
* 聚簇索引的顺序就是物理数据的存放顺序；
* 因为聚簇索引索引的结构更加紧凑，因此读取效率会更高；

2.4 主键与索引

主键就是一种特殊性的唯一索引。多数数据库在创建主键的时候，都会默认创建聚集索引；

3. 数据库事务

事务是数据中不可分割的操作序列，执行结果保证了数据库从一种一致性状态编变到另一种一致性状态

3.1 事务特征

ACID: 原子性、一致性、隔离性和持久性

3.2 事务并发的问题

* 脏读：一个事务读取了另一个事务没提交的数据；
* 不可重复读：两次读取，得到不同的结果。因为被读取的数据可以被其它事务修改；
* 幻读：有事务新增或者删除数据；

3.3 隔离级别

四种隔离级别：

未提交读：允许一个事务读取另一个事务还没commit的数据；会导致脏读

已提交读：在一个事务中只允许对其它事务已经commit的记录可见；会导致不可重复读的问题；

可重复读：在同一个事务内查询都是事务开始时一致的；

可串行化：避免了幻读；

4. 什么叫视图？游标是什么？

视图是虚拟的表，是一个或多个表的行或者列的自己，支持增删改查，但不影响真实表的结构；

游标是对查询结果集作为一个单元来进行有效的处理；

5. 什么是触发器

与表相关的数据库对象，在数据库满足某些条件的时候触发，执行触发器定义语句集合；

6. mysql的乐观锁与悲观锁

两种常见的资源并发锁设计思路

* 悲观锁：先获取锁，在进行操作，“悲观地认为所有操作都具有危险”。由于mysql在执行select语句的时候，所有扫描过的行都会被锁上，如果是没有使用索引，而是全表扫描就会带来很多问题；
* 乐观锁：先进行业务操作，在更新数据时检查数据是否改过，如果没有改过就更新成功，否则就需要回滚；
* 读多写少用乐观锁，读少写多用悲观锁；


7. 外键

外键的主要作用是做一个完整性的约束

8. 幻读以及MVCC

InnoDB利用MVVC解决幻读。通过给每个读取事务加一个版本号，这样事务只能读取<=当前版本号的数据。每当数据被修改时，版本号+1

9. redis与memcached
   1. 支持的数据类型不同；
   2. 内存管理机制不同，redis并不是所有数据都在内存中的，物理内存用完时redis可以将一些很久没用的value交换到磁盘中。memcached的内存管理机制是slab allocation，而redis是维持一个数组；
   3. redis支持数据持久化；
10. MyISAM与InnoDB的区别

* Innodb支持事务处理，外键和行级锁，MyISAM不支持
* Innodb不保存表的具体函数，在计算一个表的行数时需要扫描整个表